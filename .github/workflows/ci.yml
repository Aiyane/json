name: Portable

on: 
   push:
     branches : 
       - portable
   pull_request:
     branches : 
       - portable

jobs:
  MacOS:

    runs-on: macos-latest

    steps:
    - name: Checkout
      uses: actions/checkout@master

    - name: use Setup-Scheme
      uses: guenchi/setup-scheme@master
      with:
        implementation: chez

    # - name: install gambit scheme
    #   run: |
    #        brew install gambit-scheme
    #        sudo ln -s /usr/local/Cellar/gambit-scheme/4.9.3_1/v4.9.3/bin/gsi /usr/local/bin/gsi
    #        sudo ln -s /usr/local/Cellar/gambit-scheme/4.9.3_1/v4.9.3/bin/gsc /usr/local/bin/gsc
       
    - name : prepare files
      run: |
            git clone -b portable https://github.com/guenchi/json
            cd json
            mkdir json
            mv json.sc json/json.ss
            
    - name: test with chez scheme
      run:  |
            cd json
            chez test/test.sc
            
    # - name: test with gambit scheme
    #   run:  |
    #         cd json
    #         gsi test/test.ss

  Ubuntu:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@master

    - name: use Setup-Scheme
      uses: guenchi/setup-scheme@master
      with:
        implementation: chez

    - name : test
      run: |
            git clone -b portable https://github.com/guenchi/json
            cd json
            mkdir json
            mv json.sc json/json.ss
            scheme test/test.sc
